2025-04-13 13:22:36,789 - INFO - [24015] - root - Initializing application
2025-04-13 13:22:36,789 - INFO - [24015] - root - Setting up database connection to postgresql://postgres:7987@localhost:5432/Voice_Recognition
2025-04-13 13:22:36,877 - INFO - [24015] - root - Database setup successful
2025-04-13 13:22:36,877 - INFO - [24015] - root - Starting Flask server on port 8586
2025-04-13 13:22:36,903 - WARNING - [24015] - werkzeug -  * Debugger is active!
2025-04-13 13:22:36,927 - INFO - [24015] - werkzeug -  * Debugger PIN: 137-071-496
2025-04-13 13:22:37,623 - INFO - [24015] - root - Received upload request
2025-04-13 13:22:37,627 - INFO - [24015] - root - Upload parameters: language=ar, streaming=False,conversational mode=True
2025-04-13 13:22:37,628 - INFO - [24015] - root - File saved to uploads/4c7403f4c2a841818df99fe1b6e91778.m4a
2025-04-13 13:22:37,628 - INFO - [24015] - root - Starting batch processing mode
2025-04-13 13:22:37,628 - INFO - [24015] - root - Setting up database connection to postgresql://postgres:7987@localhost:5432/Voice_Recognition
2025-04-13 13:22:37,654 - INFO - [24015] - root - Database setup successful
2025-04-13 13:22:37,654 - INFO - [24015] - root - Database session initialized
2025-04-13 13:22:37,654 - INFO - [24015] - root - Starting audio preprocessing
2025-04-13 13:22:39,692 - INFO - [24015] - root - Audio preprocessing completed in 2.0378 seconds
2025-04-13 13:22:39,692 - INFO - [24015] - root - Starting audio transcription in ar
2025-04-13 13:22:39,692 - INFO - [24015] - root - Starting parallel audio processing with 3 workers
2025-04-13 13:22:39,692 - INFO - [24015] - root - Splitting audio file /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav into chunks of 25000ms
2025-04-13 13:22:39,709 - INFO - [24015] - root - Created 3 audio chunks
2025-04-13 13:22:39,710 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_0.wav
2025-04-13 13:22:39,710 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_25000.wav
2025-04-13 13:22:39,711 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_50000.wav
2025-04-13 13:22:42,554 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:22:42,557 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_50000.wav
2025-04-13 13:22:45,368 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:22:45,369 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_0.wav
2025-04-13 13:22:45,369 - INFO - [24015] - root - Chunk 0 processing completed
2025-04-13 13:22:46,747 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:22:46,751 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav_chunk_25000.wav
2025-04-13 13:22:46,751 - INFO - [24015] - root - Chunk 1 processing completed
2025-04-13 13:22:46,751 - INFO - [24015] - root - Chunk 2 processing completed
2025-04-13 13:22:46,752 - INFO - [24015] - root - Parallel processing completed, combined text length: 614
2025-04-13 13:22:46,753 - INFO - [24015] - root - Audio transcription completed in 7.0611 seconds, text length: 614
2025-04-13 13:22:46,753 - INFO - [24015] - root - Starting LLM processing
2025-04-13 13:22:49,892 - INFO - [24015] - httpx - HTTP Request: POST https://api.fireworks.ai/inference/v1/completions "HTTP/1.1 200 OK"
2025-04-13 13:22:49,896 - INFO - [24015] - root - LLM refining processing completed in 3.1428 seconds
2025-04-13 13:22:49,896 - INFO - [24015] - root - Starting LLM processing
2025-04-13 13:23:05,396 - ERROR - [24015] - root - Error in batch processing: LLM processing failed: [Errno 54] Connection reset by peer
Traceback (most recent call last):
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 101, in handle_request
    raise exc
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 78, in handle_request
    stream = self._connect(request)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 156, in _connect
    stream = stream.start_tls(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_backends/sync.py", line 154, in start_tls
    with map_exceptions(exc_map):
  File "/opt/homebrew/Cellar/python@3.11/3.11.11/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [Errno 54] Connection reset by peer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/muhammedamr/Desktop/AHBS/Voice recognition/src/llm_service.py", line 60, in translate_to_eng
    response = fireworks.client.Completion.create(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/fireworks/client/base_completion.py", line 81, in create
    return cls._create_non_streaming(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/fireworks/client/base_completion.py", line 180, in _create_non_streaming
    response = client.post_request_non_streaming(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/fireworks/client/api_client.py", line 159, in post_request_non_streaming
    response = self._client.post(
               ^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 1144, in post
    return self.request(
           ^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 825, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "/opt/homebrew/Cellar/python@3.11/3.11.11/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/muhammedamr/Desktop/AHBS/Refined_whisper/venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [Errno 54] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/muhammedamr/Desktop/AHBS/Voice recognition/test.py", line 339, in upload
    translated_text = LLMService.translate_to_eng(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/muhammedamr/Desktop/AHBS/Voice recognition/src/llm_service.py", line 72, in translate_to_eng
    raise Exception(f"LLM processing failed: {str(e)}")
Exception: LLM processing failed: [Errno 54] Connection reset by peer
2025-04-13 13:23:05,452 - INFO - [24015] - root - Database session rolled back
2025-04-13 13:23:05,453 - INFO - [24015] - root - Cleaned up file uploads/4c7403f4c2a841818df99fe1b6e91778.m4a
2025-04-13 13:23:05,455 - INFO - [24015] - root - Removed processed file /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmp1tjzlai8/processed_audio.wav
2025-04-13 13:23:05,460 - INFO - [24015] - root - Database session closed
2025-04-13 13:23:05,462 - INFO - [24015] - werkzeug - 127.0.0.1 - - [13/Apr/2025 13:23:05] "[35m[1mPOST /upload HTTP/1.1[0m" 500 -
2025-04-13 13:25:02,684 - INFO - [24015] - root - Received upload request
2025-04-13 13:25:02,690 - INFO - [24015] - root - Upload parameters: language=ar, streaming=False,conversational mode=True
2025-04-13 13:25:02,692 - INFO - [24015] - root - File saved to uploads/597819b2315e42798b8c9b362d651796.m4a
2025-04-13 13:25:02,693 - INFO - [24015] - root - Starting batch processing mode
2025-04-13 13:25:02,693 - INFO - [24015] - root - Setting up database connection to postgresql://postgres:7987@localhost:5432/Voice_Recognition
2025-04-13 13:25:02,863 - INFO - [24015] - root - Database setup successful
2025-04-13 13:25:02,863 - INFO - [24015] - root - Database session initialized
2025-04-13 13:25:02,863 - INFO - [24015] - root - Starting audio preprocessing
2025-04-13 13:25:03,886 - INFO - [24015] - root - Audio preprocessing completed in 1.0228 seconds
2025-04-13 13:25:03,887 - INFO - [24015] - root - Starting audio transcription in ar
2025-04-13 13:25:03,887 - INFO - [24015] - root - Starting parallel audio processing with 3 workers
2025-04-13 13:25:03,887 - INFO - [24015] - root - Splitting audio file /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav into chunks of 25000ms
2025-04-13 13:25:03,911 - INFO - [24015] - root - Created 3 audio chunks
2025-04-13 13:25:03,916 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_0.wav
2025-04-13 13:25:03,917 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_25000.wav
2025-04-13 13:25:03,919 - INFO - [24015] - root - Processing audio chunk: /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_50000.wav
2025-04-13 13:25:05,502 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:25:05,504 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_50000.wav
2025-04-13 13:25:09,649 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:25:09,652 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_25000.wav
2025-04-13 13:25:09,906 - INFO - [24015] - httpx - HTTP Request: POST https://api.groq.com/openai/v1/audio/transcriptions "HTTP/1.1 200 OK"
2025-04-13 13:25:09,909 - INFO - [24015] - root - Removed chunk /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav_chunk_0.wav
2025-04-13 13:25:09,909 - INFO - [24015] - root - Chunk 0 processing completed
2025-04-13 13:25:09,909 - INFO - [24015] - root - Chunk 1 processing completed
2025-04-13 13:25:09,909 - INFO - [24015] - root - Chunk 2 processing completed
2025-04-13 13:25:09,910 - INFO - [24015] - root - Parallel processing completed, combined text length: 614
2025-04-13 13:25:09,910 - INFO - [24015] - root - Audio transcription completed in 6.0234 seconds, text length: 614
2025-04-13 13:25:09,910 - INFO - [24015] - root - Starting LLM processing
2025-04-13 13:25:12,772 - INFO - [24015] - httpx - HTTP Request: POST https://api.fireworks.ai/inference/v1/completions "HTTP/1.1 200 OK"
2025-04-13 13:25:12,781 - INFO - [24015] - root - LLM refining processing completed in 2.8702 seconds
2025-04-13 13:25:12,781 - INFO - [24015] - root - Starting LLM processing
2025-04-13 13:25:18,194 - INFO - [24015] - httpx - HTTP Request: POST https://api.fireworks.ai/inference/v1/completions "HTTP/1.1 200 OK"
2025-04-13 13:25:18,197 - INFO - [24015] - root - LLM translation processing completed in 5.4162 seconds
2025-04-13 13:25:18,197 - INFO - [24015] - root - Starting LLM processing
2025-04-13 13:25:25,549 - INFO - [24015] - httpx - HTTP Request: POST https://api.fireworks.ai/inference/v1/completions "HTTP/1.1 200 OK"
2025-04-13 13:25:25,552 - INFO - [24015] - root - LLM processing completed in 7.3553 seconds
2025-04-13 13:25:25,552 - INFO - [24015] - root - Parsing refined text
2025-04-13 13:25:25,553 - INFO - [24015] - root - Total processing completed in 22.6895 seconds
2025-04-13 13:25:25,554 - INFO - [24015] - root - Removed processed file /var/folders/9h/zs4mvmp91456_d2n2hqf6wzc0000gn/T/tmpkndtut_n/processed_audio.wav
2025-04-13 13:25:25,554 - INFO - [24015] - root - Saving results to database
2025-04-13 13:25:25,595 - INFO - [24015] - root - Results saved to database with ID 235
2025-04-13 13:25:25,596 - INFO - [24015] - root - Database session closed
2025-04-13 13:25:25,596 - INFO - [24015] - werkzeug - 127.0.0.1 - - [13/Apr/2025 13:25:25] "POST /upload HTTP/1.1" 200 -
2025-04-13 13:28:17,922 - INFO - [24015] - werkzeug -  * Detected change in '/Users/muhammedamr/Desktop/AHBS/Voice recognition/src/prompt.py', reloading
